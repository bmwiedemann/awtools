#!/usr/bin/perl -w

use strict;
use CGI qw":standard";
my $title="trade partners [\U$ENV{REMOTE_USER}\E]";
BEGIN {chdir "/home/bernhard/code/cvs/perl/awcalc";}
use awstandard;
use awinput;
awinput_init();
use sort_table;

print AWheader($title);

my %options;

for my $p (qw'sort') {
   $options{$p}=param($p);
}
if(!defined $options{sort}){$options{sort}="-6.4.5";}

#print "test";
my @tap=gettradepartners(4, 5000);
my @tap2;
foreach my $entry (@tap) {
   my ($name, $ad, $prod, $partners)=@$entry;
   my $pid=playername2id($name);
   if(!$pid) {next}
   $name=playerid2name($pid);
   my @rel=getrelation($name);
   $$entry[0]=$name;
   my $time=(20000-$ad)/$prod;
   $$entry[1]=int($ad);
   $$entry[2]=int($prod);
#   push(@$entry, sprintf("%.2f",$time), $pid, $rel[0]);
   push(@tap2, [$pid, $ad, $prod, $partners, sprintf("%.2f",$time), $rel[0]]);
}

print sort_table([qw(who ad prod/h partners ready(h) relation)], 
         [\&display_pid, \&display_string, \&display_string, \&display_string, \&display_string, \&display_string],
         [\&sort_pid, \&sort_num, \&sort_num, \&sort_num, \&sort_num, \&sort_num],
         sort_param_to_keys($options{sort}), \@tap2 );

print AWtail();
